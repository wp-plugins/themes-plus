/**
 * https://github.com/mhuggins/jquery-countTo (MIT license)
**/

(function(a){a.fn.countTo=function(g){g=g||{};return a(this).each(function(){function e(a){a=b.formatter.call(h,a,b);f.text(a)}var b=a.extend({},a.fn.countTo.defaults,{from:a(this).data("from"),to:a(this).data("to"),speed:a(this).data("speed"),refreshInterval:a(this).data("refresh-interval"),decimals:a(this).data("decimals")},g),k=Math.ceil(b.speed/b.refreshInterval),m=(b.to-b.from)/k,h=this,f=a(this),l=0,c=b.from,d=f.data("countTo")||{};f.data("countTo",d);d.interval&&clearInterval(d.interval);d.interval=
setInterval(function(){c+=m;l++;e(c);"function"==typeof b.onUpdate&&b.onUpdate.call(h,c);l>=k&&(f.removeData("countTo"),clearInterval(d.interval),c=b.to,"function"==typeof b.onComplete&&b.onComplete.call(h,c))},b.refreshInterval);e(c)})};a.fn.countTo.defaults={from:0,to:0,speed:1E3,refreshInterval:100,decimals:0,formatter:function(a,e){return a.toFixed(e.decimals)},onUpdate:null,onComplete:null}})(jQuery);


/*global jQuery:false */

// Initialize countTo on scroll/touchmove, if in viewport
(function ($) {
    "use strict";
    
    var $window = $(window);
    
    function isElementInViewport (el) {
        if (el.length === 0) {
            return false;
        } else {
            el = el[0];
        }
        
        var rect = el.getBoundingClientRect();
        return (
            rect.top >= 0 &&
            rect.left >= 0 &&
            rect.bottom <= $window.height() &&
            rect.right <= $window.width()
        );
    }
    
    function startCountTo () {
        var $timer = $('.countup');
        
        if (isElementInViewport($timer) && $timer.is(':empty')) {
            $timer.countTo({
                formatter: function (value, options) {
                    return new Intl.NumberFormat().format(value.toFixed(0));
                }
            });
        }
        
        if (!isElementInViewport($timer)) {
            $timer.html(""); // clear content if not in viewport
        }
    }
    
    $(document).ready(function () {
        $('.countup').html(""); // clear content on start
        
        startCountTo();
    });
    
    $window.on('scroll touchmove', function () {
        startCountTo();
    });
    
}(jQuery));